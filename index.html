<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Kakao Map with Route</title>
    <script
      type="text/javascript"
      src="//dapi.kakao.com/v2/maps/sdk.js?appkey=7bc3531859eb18a2d6729cdac95c62c7&libraries=services"
    ></script>
  </head>
  <body>
    <div id="map" style="width: 100%; height: 100%"></div>

    <script>
      const mapContainer = document.getElementById("map");
      const mapOptions = {
        center: new kakao.maps.LatLng(33.450701, 126.570667),
        level: 3,
      };

      const map = new kakao.maps.Map(mapContainer, mapOptions);

      if (window.ReactNativeWebView) {
          window.ReactNativeWebView.postMessage('map_loaded');
        }
      
      window.addEventListener("message", (event) => {
        const message = JSON.parse(event.data);
        const { initial, destination, waypoint } = message;

        const initialPoint = new kakao.maps.LatLng(
          initial.latitude,
          initial.longitude
        );
        const destinationPoint = new kakao.maps.LatLng(
          destination.latitude,
          destination.longitude
        );
        const waypointPoint = new kakao.maps.LatLng(
          waypoint.latitude,
          waypoint.longitude
        );

        const directionsService = new kakao.maps.services.Directions();

        directionsService.route({
          origin: initialPoint,
          destination: destinationPoint,
          waypoints: [waypointPoint],
          success: function (result) {
            const distance = result.sections.reduce(
              (acc, section) => acc + section.distance,
              0
            );
            window.ReactNativeWebView.postMessage(JSON.stringify({ distance }));
          },
          error: function (error) {
            console.error("Directions request failed:", error);
          },
        });
      });
    </script>
  </body>
</html>
